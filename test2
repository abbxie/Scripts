local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local root = character:WaitForChild("HumanoidRootPart")
local humanoid = character:WaitForChild("Humanoid")

local worldBlocks = workspace:WaitForChild("WorldBlocks")

-- Highlight object
local highlight = Instance.new("SelectionBox")
highlight.LineThickness = 0.05
highlight.SurfaceTransparency = 0.5
highlight.Color3 = Color3.fromRGB(255, 0, 0)
highlight.Parent = game.CoreGui

-- Track last facing direction (default up)
local lastDirection = Vector3.new(0,0,-1)

-- Update lastDirection based on velocity
RunService.RenderStepped:Connect(function()
    local vel = root.Velocity
    if math.abs(vel.X) > math.abs(vel.Z) then
        lastDirection = Vector3.new(math.sign(vel.X), 0, 0)
    elseif math.abs(vel.Z) > 0 then
        lastDirection = Vector3.new(0, 0, math.sign(vel.Z))
    end
end)

-- Function to find Dirt straight ahead in 2D
local function getDirtStraight2D()
    local closest = nil
    local shortestDist = math.huge
    local playerPos = root.Position

    for _, block in ipairs(worldBlocks:GetChildren()) do
        local dirt = block:FindFirstChild("Dirt")
        if dirt and dirt:IsA("BasePart") then
            local dirToDirt = dirt.Position - playerPos
            local alongAxis = lastDirection.X ~= 0 and math.sign(dirToDirt.X) == lastDirection.X
                             or lastDirection.Z ~= 0 and math.sign(dirToDirt.Z) == lastDirection.Z

            if alongAxis then
                local dist = dirToDirt.Magnitude
                if dist < shortestDist then
                    shortestDist = dist
                    closest = dirt
                end
            end
        end
    end

    return closest
end

-- Update loop
RunService.RenderStepped:Connect(function()
    local dirtAhead = getDirtStraight2D()
    if dirtAhead then
        highlight.Adornee = dirtAhead
    else
        highlight.Adornee = nil
    end
end)
